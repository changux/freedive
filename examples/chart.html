<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chart example</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <script src="../js/modernizr.custom.2.6.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery.1.9.1.min.js" type="text/javascript" charset="utf-8"></script>
  <!-- <script src="../js/main.js" type="text/javascript" charset="utf-8"></script> -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="../styles/dark.css" type="text/css" media="screen" title="no title" charset="utf-8">
<script type="text/javascript" src="https://www.google.com/jsapi"></script> 
<script type="text/javascript"> google.load('visualization', '1.1', {packages:['controls']}); </script> 
  
  <script type="text/javascript" src="../js/css3-mediaqueries.js"></script>

<style type="text/css"> 
	#fd_main p{font:13px/16px Arial;margin-bottom:10px !important;padding:0;}
	#fd_main h4{font-family:Arial;font-weight:bold;text-transform:uppercase;text-align:left;padding:0 0 5px 0;margin:0;}
	#fd_main label{font:bold 13px/24px Arial;padding:0 5px 0 0;float:left;vertical-align:middle;}
	#fd_main input,textarea,select,button{font:13px/16px Arial;color:#959595;vertical-align:middle;}
	.fd_note{font-family:Arial;color:#5E5E5E;font-size:.8em;border:none;padding:0;}
	div.search_widget{background:#E1E1E1;background:-webkit-gradient(linear,left top,left bottom,from(#FFF),to(#E1E1E1));background:-webkit-linear-gradient(top,#FFF,#E1E1E1);background:-moz-linear-gradient(top,#FFF,#E1E1E1);background:-ms-linear-gradient(top,#FFF,#E1E1E1);background:-o-linear-gradient(top,#FFF,#E1E1E1);border:2px solid #E1E1E1;padding:20px;-moz-border-radius:10px;-webkit-border-radius:10px;margin-bottom:20px;}
	div.control{margin:0 10px 15px 0;color:black;height:26px;float:left;}
	div.chart1{float:left;}
	.header{background-color:#5B5B5B;color:#FFFFFF;font-family:Arial,sans-serif;text-align:left;font-size:0.8em;text-transform:uppercase;font-weight:600;letter-spacing:1px;line-height:1.4em;border:none;}
	.row{background-color:#FFFFFF;color:#3F3F3F;font-family:inherit;font-size:0.9em;}
	.oddRow{background-color:#F5F5F5;color:#3F3F3F;font-family:inherit;text-align:left;font-size:0.9em;}
	.hoverRow{background-color:#CDCDCD;font-family:inherit;text-align:left;font-size:0.9em;}
	.selectedRow{background-color:#DCDCDC;color:#3F3F3F;text-align:center;font-family:inherit;text-align:left;font-size:0.9em;}
	.cell,table{padding:2px;border:none;}
	.headCell{padding:0;}
	.goog-menu{font-family:Arial;}
	.goog-menuitem-content{color:#3F3F3F;}
	.goog-menuitem-highlight,.goog-menuitem-hover{background-color:#F0F0F0;border-color:#F0F0F0;}
	.goog-menu-button-focused .goog-menu-button-outer-box,.goog-menu-button-focused .goog-menu-button-inner-box{border-color:#B1B1B1;margin}
	.goog-menu-button-inner-box{font:13px/18px Arial,sans-serif;margin:2px 0;padding:0 5px;}
	.goog-menu-button-hover .goog-menu-button-outer-box,.goog-menu-button-hover .goog-menu-button-inner-box{border-color:#B1B1B1!important;}
	.goog-menu-button-active,.goog-menu-button-open{background-color:#F0F0F0;border-color:#B1B1B1;background-position:bottom left}
	.goog-menu-button-focused .goog-menu-button-outer-box,.goog-menu-button-focused .goog-menu-button-inner-box{border-color:#B1B1B1}
	.google-visualization-controls-slider-horizontal{border:0px;background-color:#DBDBDB;border-radius:5px;-moz-border-radius:5px;outline:none;height:8px;}
	.google-visualization-controls-slider-thumb{background-color:#616161;border:none;width:12px;height:12px;}
	.google-visualization-controls-slider-horizontal .google-visualization-controls-slider-handle{height:8px;}
	.google-visualization-controls-slider-horizontal .google-visualization-controls-slider-thumb{top:-2px;left-margin:8px;border-radius:2px;-moz-border-radius:2px;}
	.google-visualization-controls-slider-handle{background-color:#616161;opacity:.6;height:4px;}
	.google-visualization-controls-rangefilter-thumblabel{font:13px/24px Arial;color:#3F3F3F;padding:0 0.5em}
	#page-loader{position:absolute;top:0;bottom:0%;left:0;right:0%;background-color:white;z-index:99;display:none;text-align:center;width:100%;padding-top:25px;}
</style>
</head>
<body style="background-color:#FFFFFF;color:#3F3F3F">
  <!-- Navigation -->
  <nav>
    <div id="smartphone_menu">Menu</div>
    <ul>
      <li><a href="#home">Home</a></li>
      <li><a href="#article1">Introduction</a></li>
      <li><a href="#article2">Key Features</a></li>
      <li><a href="#article3">Examples</a></li>
      <li><a href="#article4">Tutorial videos</a></li>
      <li><a href="wizard.html">Use the wizard</a></li>
      <li><a href="faq.html">FAQ</a></li>
    </ul>
  </nav>



<div style="margin:60px auto;width:85%">
	<div id="intro">
		<!-- <div style="width:599px; float:left;"> -->
			<h1 id="chart_headline" style="line-height:36px;">
				Movie Hunt: Find something to watch from the last 5 years
			</h1>
			<p>
				This graphic is an example of one of the new charting features available in freeDive. Click <strong>See all records</strong> and take a moment to play with all the options below. You can adjust the budget range to show blockbusters, search for an Academy Award (Oscars) winner or select a genre (try comedy). Here's the <a href="https://docs.google.com/spreadsheet/ccc?key=0AtP_YtDJ532RdG5WUVpjRUx2bHpNQTcxWXhUanZjWnc#gid=0"><strong>publicly available data.</strong></a>
			</p>
			<p>
				This is an experimental feature and there may be bugs. The only confirmed conflict is with the Firebug plugin in Firefox, which can cause a browser to crash. When Firebug is disabled, the graphic renders correctly. Other than that, the graphic appears to work in all major browsers, including Internet Explorer.
			</p>
			<p>
				As always your <a href="http://multimedia.journalism.berkeley.edu/contact/"><strong>feedback</strong></a> is greatly appreciated.
			</p>
			<p>
				<span class="fd_note">Data was provided by Information is Beautiful for their <a href="http://www.informationisbeautiful.net/2012/hollywood-budgets-a-data-viz-challenge/">Visualize Hollywood</a> contest.<br />
				SOURCES: Primary studio information from Wikipedia individual film pages; <a href="http://www.imdb.com/">Internet Movie Database</a>; Budget information from <a href="http://www.the-numbers.com/movies/records/allbudgets.php">The Numbers</a> and <a href="http://www.boxofficemojo.com/">Box Office Mojo</a></span>
			</p><br />
		</div>
		<div id="container">
			<!-- </div> -->
			<div id="fd_main" style='width:896px'>
				<div id="full_search" class="search_widget" style='float:left;width:896px'>
					<h4>
						Find a movie
					</h4>
					<p class="fd_note">
						Text search is case sensitive. Leave fields blank to see the entire database (may cause longer load times).
					</p>
					<p>
						<label for="search_text">Film name includes</label> <input style="float:left; margin-right:40px;" id="search_text" value="" onfocus="changeSearchButton1()" />
					</p>
					<div id="num_search_bit">
						<p>
							<label for='range_num'>Rotten Tomatoes score (%)</label> <select name='sheet_op' id='sheet_op'>
								<option value='&gt;='>
									Greater than or equal to
								</option>
								<option value='&lt;='>
									Less than or equal to
								</option>
								<option value='&gt;'>
									Greater than
								</option>
								<option value='&lt;'>
									Less than
								</option>
								<option value='='>
									Equals
								</option>
							</select><input id='range_num' value='Enter a number' />
						</p>
					</div>
					<div id="name">
						<p style='position:absolute;left:10000px;'>
							<input id='range_num' value='' />
						</p>
					</div>
					<p>
						<span class="fd_note" style="float:left;">Powered by <a href="http://multimedia.journalism.berkeley.edu/tools/freedive">freeDive</a></span> <input id="submit_button" type="submit" value="SEARCH" onclick="fd_refresh()" style="float:right; color:#000;" />
					</p>
				</div>
				<div id="page_loader"></div>
				<div id="dashboard" style='width: 940px;font-family:Arial, sans-serif;float:left;'>
					<h4>
						Explore your results
					</h4>
					<p>
						<b>Instructions:</b> Use the filter(s) below to customize your search results. Use the tool above to perform a new search.
					</p>
					<div id="control1" class="control"></div>
					<div id='control2' class='control'></div>
					<div id='control3' class='control'></div><br />
					<br />
					<div id='chart_div' class='control' style='height: 600px; width: 940px;'>
						<p style="font-size:1.3em;color:#772327;text-align:center;padding:60px 0 20px">
							Fetching data... Thank you for waiting.
						</p>
						<p style="color:#3F3F3F;text-align:center;padding:20px 0">
							Searches with a large number of results may take longer to load.
						</p>
					</div><br />
					<br />
					<div class="fd_note" style="width:100%; margin-bottom:.3em">
						Click on a column label to resort the table.
					</div>
					<div id="chart1" class="chart1">
						<p style="font-size:1.3em;color:#772327;text-align:center !important;padding:60px 0 20px">
							Fetching data... Thank you for waiting.
						</p>
						<p style="color:#3F3F3F;text-align:center !important;padding:20px 0">
							Searches with a large number of results may take longer to load.
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		$.extend({
			getUrlVars: function() {
				var vars = [],
					hash;
				var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				for (var i = 0; i < hashes.length; i++) {
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			},
			getUrlVar: function(name) {
				return $.getUrlVars()[name];
			}
		});
	
	 
	anyquery = false;
	fdnq = decodeURIComponent($.getUrlVar('fdnq'));
	fdop = decodeURIComponent($.getUrlVar('fdop'));
	fdtq = decodeURIComponent($.getUrlVar('fdtq'));
	fdall = decodeURIComponent($.getUrlVar('fdall'));
	if (fdall != 'undefined') {
		fdall = true;
	} else {
		fdall = false;
	};
	if (fdtq != 'undefined' || fdnq != 'undefined' || fdall == true) {
		anyquery = true;
		google.setOnLoadCallback(drawVisualization());
	} else {
		fdtq = 'Enter case-sensitive text';
		fdnq = 'Enter a number';
	};

	function drawVisualization() {
		var search_url = 'https://spreadsheets.google.com/a/google.com/tq?key=0AtP_YtDJ532RdG5WUVpjRUx2bHpNQTcxWXhUanZjWnc';
		if (fdtq == 'undefined') {
			fdtq = '';
		};
		if (fdnq == 'undefined') {
			fdnq = '';
		};
		if (fdall) {
			var querystring = "select *";
		} else {
			var querystring = "select A,B,C,D,E,F,G,H,I where ";
			if (fdtq != '' && fdnq == '') {
				querystring = querystring + "A like '%" + fdtq + "%'";
			} else if (fdtq == '' && fdnq != '') {
				querystring = querystring + "B" + fdop + fdnq;
			} else {
				querystring = querystring + "A like '%" + fdtq + "%'" + " and " + "B" + fdop + fdnq;
			};
		};
		querystring = encodeURIComponent(querystring);
		search_url = search_url + "&tq=" + querystring;
		search_url = search_url.replace(/#&tq/, '&tq');
		var query = new google.visualization.Query(search_url);
		query.send(handleQueryResponse);
	}
	function handleQueryResponse(response) {
		if (response.isError()) {
			console.log('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
			return;
		}
		var data = response.getDataTable();
		var control1_use = new google.visualization.ControlWrapper({
			'controlType': 'NumberRangeFilter',
			'containerId': 'control1',
			'options': {
				'filterColumnLabel': 'Worldwide Gross ($m)',
				'matchType': 'any',
				'ui': {
					'label': 'Adjust budget range',
					'cssClass': 'custom-stringfilter',
					'allowMultiple': false,
					'allowTyping': false
				}
			}
		});
		var control2_use = new google.visualization.ControlWrapper({
			'controlType': 'StringFilter',
			'containerId': 'control2',
			'options': {
				'filterColumnLabel': 'Oscar',
				'matchType': 'any',
				'ui': {
					'label': 'Search by Academy awards',
					'cssClass': 'custom-stringfilter',
					'allowMultiple': false,
					'allowTyping': false
				}
			}
		});
		var control3_use = new google.visualization.ControlWrapper({
			'controlType': 'CategoryFilter',
			'containerId': 'control3',
			'options': {
				'filterColumnLabel': 'Genre',
				'matchType': 'any',
				'ui': {
					'label': 'Genre',
					'cssClass': 'custom-stringfilter',
					'allowMultiple': false,
					'allowTyping': false
				}
			}
		});
		var classes = {
			headerRow: 'header',
			tableRow: 'row',
			hoverTableRow: 'hoverRow',
			oddTableRow: 'oddRow',
			selectedTableRow: 'selectedRow',
			tableCell: 'cell',
			headderCell: 'headCell'
		};
		var chart = new google.visualization.ChartWrapper({
			'chartType': 'BubbleChart',
			'containerId': 'chart_div',
			'options': {
				'bubble': {
					'opacity': 0.4,
					'stroke': 'none',
					'textStyle': {
						'color': 'none'
					}
				},
				'vAxes': [{
					'titleTextStyle': {
						'color': '#858585',
						'italic': true,
						'fontSize': 12
					},
					'baselineColor': '#aaa',
					'gridlineColor': '#eee',
					'title': 'Audience score (%)',
					'textStyle': {
						'color': '#bbb',
						'fontSize': 11
					}
				}],
				'hAxis': {
					'titleTextStyle': {
						'color': '#858585',
						'italic': true,
						'fontSize': 12
					},
					'baselineColor': '#aaa',
					'gridlineColor': '#eee',
					'title': 'Rotten Tomatoes (%)',
					'textStyle': {
						'color': '#bbb',
						'fontSize': 11
					}
				},
				'title': 'Movies by review scores, budget and genre (click bubbles for details)',
				'titleTextStyle': {
					'color': '#3F3F3F',
					'fontSize': 14
				},
				'legend': {
					'position': 'top',
					'textStyle': {
						'color': '#3F3F3F',
						'fontSize': 12
					}
				},
				'chartArea': {
					'width': '90%',
					'height': '85%'
				},
				'colors': ['#aaa', '#CCCA9E', '#9FB7CC', '#CCB49E', '#9EA0CC', '#B49ECC', '#CA9ECC', '#9ECCCA', '#7699B7', '#537A9D', '#CC9EB7', '#9ECCB4', '#9D7553', '#B79476', '#CC9EA0', '#A0CC9E', '#B7CC9E']
			},
			'view': {
				'columns': [0, 1, 2, 3, 7]
			}
		});
		var table = new google.visualization.ChartWrapper({
			'chartType': 'Table',
			'containerId': 'chart1',
			'options': {
				'height': '400px',
				'cssClassNames': classes,
				'width': '940px',
				'allowHtml': 'true'
			}
		});
		var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard')).bind([control1_use, control2_use, control3_use], [table, chart]).draw(data);
		$('div#dashboard').show();
	};
	 
	if (anyquery == false) {
		$('div#dashboard').hide();
	};
	$('input#search_text').val(fdtq);
	$('input#range_num').val(fdnq);

	function changeSearchButton1() {
		document.getElementById('submit_button').value = 'SEARCH';
	};

	function fd_refresh() {
		var fdop = $('#sheet_op').val();
		var fdnq = $('#range_num').val();
		var fdtq = $('#search_text').val();
		var sURL = window.location.href;
		sURL = sURL.replace(/(fdtq=.*&|fdtq=.*$)/gi, '');
		sURL = sURL.replace(/(fdnq=.*&|fdnq=.*$)/gi, '');
		sURL = sURL.replace(/(fdop=.*&|fdop=.*$)/gi, '');
		sURL = sURL.replace(/(fdall=.*&|fdall=.*$)/gi, '');
		sURL = sURL.replace(/&$/, '');
		var qs = '';
		var found = sURL.search('\\?');
		if (found == -1) {
			qs = "?";
		};
		if (fdnq == "Enter a number") {
			fdnq = ''
		};
		if (fdtq == "Enter case-sensitive text") {
			fdtq = ''
		};
		if (fdnq == '' && fdtq == '') {
			var allrecs = true;
		};
		if (allrecs) {
			qs = qs + "fdall=true";
		} else {
			qs = qs + "&fdop=" + encodeURIComponent(fdop) + "&fdnq=" + encodeURIComponent(fdnq) + "&fdtq=" + encodeURIComponent(fdtq);
		};
		sURL = sURL + qs;
		window.location.replace(sURL);
	}
	

	$(document).ready(function() {
		$('input#range_num').focus(function() {
			if ($(this).val() == 'Enter a number') $(this).val('');
		}).blur(function() {
			if ($(this).val() == '') $(this).val('Enter a number');
		});
		$('input#search_text').focus(function() {
			if ($(this).val() == 'Enter case-sensitive text') $(this).val('');
		}).blur(function() {
			if ($(this).val() == '') $(this).val('Enter case-sensitive text');
		});
		if (anyquery == false) {
			document.getElementById('submit_button').value = 'SEE ALL RECORDS';
		} else {
			document.getElementById('submit_button').value = 'SEARCH';
		};
	});
</script>

</body>
</html>

